# Application-of-ML-models-for-Brain-Cancer-classification
Application of ML models on images of brain scans to identify and classify brain cancers (Astrocytomas, Oligodendrogliomas, and Glioblastomas)

## Order to Run code 
*files of brain scan images not included*
1. HIDS509_finalProject_step1.ipynb
2. HIDS509_finalProject_step234.ipynb

## Abstract
The non-invasive nature of Brain Tumor classification using machine learning models on imaging data is a very attractive draw to many physicians and patients around the world. Currently, brain tumor diagnosis and classification largely rely on histopathological analysis of biopsy specimens. This method requires brain surgery to get a sample of the tumor in question which is invasive, time-consuming, and prone to human error. This paper aims to make multi-classification of brain tumors for diagnostic purposes using machine learning models. The classification task at hand was to use machine learning feature extraction from MRI images of three different brain tumor types (Astrocytoma, oligodendroglioma, and glioblastoma multiforme GBM). All the important hyper-parameters of the machine learning models used are automatically designated using grid search optimization algorithm. Classification results are obtained using The Cancer Genomic Atlas (TCGA) Brain Cancer MRI dataset with radiomic features for training and the REMBRANDT dataset with radiomic features for testing the accuracy of the models created. The proposed models, after some improvements, could be used to assist physicians and radiologists in validating their initial screening for brain tumor multi-classification purposes. 

## Introduction 
Brain tumors are generated by the abnormal proliferation of brain cells that create masses that adversely affect brain and body health. Early detection and classification of the exact tumor type that is growing in an individual's brain is an important field of research involving medical imaging and informatics to determine the most convenient and correct treatment method to save that individual's life. 

Astrocytoma, Oligodendroglioma, and GBM are the tumor types that were set out to be classified using machine learning from MRI imaging data in the current project. Astrocytoma tumors affect glial cells, specifically, the star-shaped cells that form the supportive tissue of the brain called astrocytes. These tumors can grow fast and large but most often slowly. GBM is a grade IV infiltrating astrocytoma and is the most aggressive type of nervous system tumor. The name “malforme” is derived from its wide variety of appearance under the microscope. GBM occurs most often in adults between 50-80 years old and is more common in men.1 Oligodendroglioma develops from cells called oligodendrocytes which create a substance that protects nerves in the brain and helps them function. Each of these types of tumors can be further classified into grades indicating how slowly or quickly they grow.2 GBM is a grade IV astrocytoma and has the shortest predicted lifespan for the individual diagnosed with a median survival around 9 months. 

The use of non-invasive classification of tumor type using ML models has the potential to lead to quick determination of diagnosis, treatment planning, and evaluation of treatment outcome. Radiomics encapsulates a broad set of computational methods that are used to extract quantitative features from radiographics images. These features in theory and practice can be used to inform imaging diagnosis, prognosis, and therapy responses. Radiomics in neuro-oncology, tries to improve the understanding of the biology of brain tumors through the extraction of quantitative features from clinical imaging arrays.3 Image-based computational models are, therefore, becoming a critical technology that allows identification, analysis, and validation of extracted quantitative features.

The final diagnosis is typically made after clinical examination and interpretation of imaging (MRI/CT scans) followed by pathological investigation. The biggest disadvantage of this current model is the invasive nature, slow time scale form start to finish, and openness to sampling errors. The application of models like the ones built in this project have the potential to aid physicians in making fast, accurate, and non-invasive decisions. 

## Materials and Methods
### Datasets 
Two different datasets were used to build the ML models in this project. The first dataset used to train the models created was sourced from the TCGA data collection, which was a publicly available dataset, including pyradiomics features generated from the MRI images per individual. These clinical dataset tied to these individuals included race and gender information. The dataset in total included information on 231 individuals spanning four types of brain tumors (Oligoastrocytoma: 28, Astrocytoma: 32, GBM: 124, Oligodendroglioma: 47). The testing dataset was pulled from the REMBRANDT brain cancer data set, sourced from The Cancer Imaging Archive (TCIA) a publically available platform. PyRadiomics features were extracted from the REMBRANDT dataset and its 64 individuals spanning three types of brain tumors (Astrocytoma: 28, GBM: 18, Oligodendroglioma: 12, Nan: 6). The REMBRANDT dataset only had final confirmation of disease type on 58 individuals, who were eventually used in our model as the test set, spanning the three tumor types (Astrocytoma: 28, GBM: 18, Oligodendroglioma: 12). 

### PyRadiomics Feature Extraction
The 64 individuals included in the REMBRANDT dataset that had MRI T1 image and labeled mask data were extracted from the files provided by the open source TCIA data source. These files were loaded into a directory and run through the Python Radiomics package. Using the feature extractor on all T1 image files and corresponding labeled image files the radiomics feature file was ready to be exported and cleaned. The 3D features generated from this package were dumped along with the columns that included information like package version name, version number, and hash feature columns. Eventually leaving 111 radiomics features. The ground truth file for the REMBRANDT patients included complete information and disease type for 58 of its original 64 individuals. The age data collected for these individuals was dumped and could not be included as a feature due to the fact the training TCGA dataset did not include age for its individuals. The gender information was also dumped from this REMBRANDT test dataset because the information was not filled out completely for all individuals.

The radiomics features generated from the TCGA individuals were provided. Cleaning this feature dataframe in the same manner as the REMBRANDT features, the TCGA feature dataframe fit for training included the same 111 features. The TCGA training features and outcomes dataset included 203 individuals. The clinical file that included the disease type for the individuals in the TCGA set also had some demographics information, including patient race and gender. However, due to the fact the race column was not a feature included in the REMBRANDT dataset this column had to be dumped and could not be included as a clinical feature fit to train. Also, the gender information was missing for some of the REMBRANDT patients used in the test set so the Gender column was also dumped and could not be included as a clinical feature. 

### TCGA Feature Extraction 
Random Forest classifier was fit on a split of training and testing data extracted from purely teh TCGA dataset. The results of this TCGA only dataset using Random Forest Classifier as the ML model was an accuracy score of 0.54. The top features of the radiomics information, strictly using the TCGA dataset, were generated using random forest. The top five features included : diagnostics_Mask-original_VolumeNum, original_shape_Elongation, original_glcm_idn, original_shape_Sphericity, original_firstorder_kurtosis. Diagnostic mask volume was the top feature indicating importance for the volume generated from the marked area of the tumor provided by the labeled image file. The biological implication for this being the top feature predictor of tumor type may be due to the nature of tumor growth amongst the three tumor types analyzed. GBM with the fastest growth rate might set it apart in size from the other two making this feature an important tool for differentiating between the tumor types. The original shape elongation information, the second most important feature, is a value that shows the relationship between the two largest principal components in the ROI shape (shape of marked brain tumor in this case). The original GLCM IDN, the third most important feature, described both the second-order joint probability function of an image region constrained by the mask as well as the measure of the local homogeneity of the image. GBM is largely made up of three tissue types chiefly necrosis, active tumor, and edema. This heterogeneity captured by this feature type may be a good indication of the difference between this tumor type (GBM) and the other two tumor types (Astrocytoma/Oligodendroglioma).4 The original shape sphericity, the fourth most important feature, provides a measure of the roundness of the shape of the tumor region relative to a sphere. Finally, the original first-order kurtosis, the fifth most important feature, provides a measure of the “peakedness” of the distribution of values in the image region of interest (ROI). Kurtosis values have been shown to be a good feature to determine poor prognosis in GBM cases. Those with low kurtosis scores fell into the poor prognosis group with biological implications that the tumors of these patience were almost the same amount of necrosis, neoangiogenesis, edema, and/or tumor cells.5

### GridSearch: ML Models 
Three approaches were taken when training and testing the ML models. First, the GridSearch constructed was run using all cleaned data available, then the GridSearch was run using only the top 50 features, and finally the GridSearch was run using only the top 20 features. Feature selection appeared to have some effect on the accuracy of the models, the top 20 features results being the best. The GridSearch setup was the same for all three approaches. First, the models to be tested were chosen; Logistic Regression, Decision Tree Classifier, Random Forest, KNeighbors, Support Vector Machine (SVM), and XGBoost Classifier. Then a list of parameter ranges, n estimators, and learning rates were saved into lists. These lists were used in the gridsearch as it iterated through all parameters for each model to determine which model had the highest accuracy as a result of which hyperparameters used. 

## Results
The best result as determined by the accuracy and the correct predictions of the disease type in the outcome data confirmed with confusion matrices was the K-Nearest Neighbors model. This model was chosen after feature selection of the top 20 TCGA features. The GridSearch set up found K-Neighbors had the highest accuracy score using the hyperparameters here: ‘KNN__metric': 'manhattan', 'KNN__n_neighbors': 6, 'KNN__weights': 'uniform'. The accuracy score of this model was 0.362 and the confusion matrix confirmed it correctly predicted 21 of the 58 REMBRANDT patients disease types. This model correctly predicted 4 of the 28 Astrocytoma tumor type, 14 of the 18 GBM tumor type, and 3 of the 12 Oligodendroglioma tumor type.



## Discussion
### Limitations of Dataset 
Sample size is one of the largest determinants of a truly successful and accurate machine learning model. While 203 is a great sample size for an open access ML model training project on brain imaging data it would be to the benefit of the model accuracy to train using more individuals. The test data as provided by the REMBRANDT dataset was missing the final disease type diagnosis for 6 of its 64 patients leaving us with only 58 patients to test our models with and produce predictions for. Demographics information would have been interesting to add to our feature matrix but due to the natures of the training and testing datasets not including the same feature types or complete results all demographics data provides; age, race, and gender were all dropped from being included in our final feature matrix used for training and testing. 

### Future Research 
The combination of the fields of imaging analytics and brain tumor diagnosis is a very interesting and promising research area that suggests a future with quick and non-invasive diagnosis of brain tumor type. The future of the models presented in this project would need much improvement before they could be deployed in the aid of physician diagnosis. However, this is a step in the right direction along that path. Perhaps with more data, hyperparameter tuning, and the introduction of Convolutional Neural Networks the accuracy of this project could reach a threshold for translation into clinical use. 
